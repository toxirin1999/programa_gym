<!-- templates/entrenos/vista_plan_calendario.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Calendario de Entrenamiento - {{ cliente.nombre }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    /* === BASE BODY CYBERPUNK === */
    body {
        background: url("{% static 'images/fondo_cyberpunk.png' %}") no-repeat center center fixed !important;
        background-size: cover !important;
        background-color: #000000 !important;
        min-height: 100vh !important;
        filter: brightness(0.9);

    }
.page-wrapper {
    width: 100%;
    overflow-x: hidden; /* Aplicamos la regla aquí, de forma segura */
}
    /* === ANIMACIONES BASE === */
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }
    body.modal-open {
    overflow: inherit !important;
    padding-right: 0 !important; /* Bootstrap a veces añade un padding para compensar el scroll, lo reseteamos */
}
    .animate-float {
        animation: float 6s ease-in-out infinite;
    }

    @keyframes fadeSlide {
        0% { opacity: 0; transform: translateY(10px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeSlide {
        animation: fadeSlide 0.8s ease-out;
    }

    @keyframes pulse-neon {
        0%, 100% {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4), inset 0 0 8px rgba(0, 255, 255, 0.2);
        }
        50% {
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.6), inset 0 0 12px rgba(0, 255, 255, 0.3);
        }
    }
    .pulse-neon {
        animation: pulse-neon 3s ease-in-out infinite;
    }

    @keyframes titleGlow {
        0%, 100% { text-shadow: 0 0 30px rgba(0, 255, 255, 0.5); }
        50% { text-shadow: 0 0 60px rgba(0, 255, 255, 0.8), 0 0 40px rgba(255, 0, 255, 0.6); }
    }

    @keyframes dataFlow {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    @keyframes dayPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* === EFECTOS ATMOSFÉRICOS === */
    .blade-runner-atmosphere {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }

    .background-fog {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 30% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 70% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
        animation: float 8s ease-in-out infinite;
    }

    /* === CONTENEDOR PRINCIPAL === */
    .cyber-calendar-container {
        background: rgba(0, 0, 0, 0.4) !important;
        backdrop-filter: blur(15px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(15px) saturate(180%) !important;
        border: 1px solid rgba(77, 208, 225, 0.6) !important;
        box-shadow: 0 0 15px rgba(77, 208, 225, 0.4), inset 0 0 8px rgba(77, 208, 225, 0.2) !important;
        padding: 2rem;
        border-radius: 20px;
        margin: 2rem auto;
        max-width: 1200px;
        min-height: 80vh;
        position: relative;
        overflow: hidden;
    }

    .cyber-calendar-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #00ffff, #ff00ff, #00ff00);
        animation: float 3s ease-in-out infinite;
    }

    /* === HEADER DEL CALENDARIO === */
    .cyber-calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: rgba(0, 0, 0, 0.6) !important;
        backdrop-filter: blur(20px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
        border: 1px solid rgba(0, 255, 255, 0.6) !important;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.3), inset 0 0 15px rgba(0, 255, 255, 0.1) !important;
        border-radius: 15px;
    }

    .cyber-calendar-header h3 {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(90deg, #00ffff, #00ff00, #ff00ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
        text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        animation: titleGlow 4s ease-in-out infinite alternate;
        margin: 0;
        text-align: center;
        flex: 1;
    }

    /* === BOTONES DE NAVEGACIÓN === */
    .cyber-nav-btn {
        background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6)) !important;
        border: 1px solid rgba(0, 123, 255, 0.8) !important;
        color: #ffffff !important;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.4);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
    }

    .cyber-nav-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s ease;
    }

    .cyber-nav-btn:hover::before {
        left: 100%;
    }

    .cyber-nav-btn:hover {
        background: linear-gradient(45deg, rgba(0, 123, 255, 1), rgba(0, 150, 255, 0.8)) !important;
        box-shadow: 0 0 25px rgba(0, 123, 255, 0.6);
        transform: translateY(-2px);
        color: #ffffff !important;
    }

    /* === BOTÓN RESUMEN ANUAL === */
    .cyber-nav-btn.resumen-anual {
        background: linear-gradient(45deg, rgba(25, 135, 84, 0.8), rgba(0, 255, 100, 0.6)) !important;
        border: 1px solid rgba(25, 135, 84, 0.8) !important;
        box-shadow: 0 0 15px rgba(25, 135, 84, 0.4);
    }

    .cyber-nav-btn.resumen-anual:hover {
        background: linear-gradient(45deg, rgba(25, 135, 84, 1), rgba(0, 255, 100, 0.8)) !important;
        box-shadow: 0 0 25px rgba(25, 135, 84, 0.6);
    }

    /* === GRID DEL CALENDARIO === */
    .cyber-calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-top: 1rem;
    }
/* ======================================================= */
/* === ESTILOS DINÁMICOS PARA LA CABECERA DEL MODAL === */
/* ======================================================= */

/* --- Estilo por defecto de la cabecera (el que ya tienes) --- */
.cyber-modal .modal-header {
    background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6)) !important;
    border-bottom: 1px solid rgba(0, 255, 255, 0.3) !important;
    border-radius: 15px 15px 0 0;
    transition: all 0.4s ease; /* Añadimos una transición suave */
}

/* --- Header para Fase de Acumulación (Hipertrofia) --- */
.cyber-modal .modal-header.header-fase-acumulacion {
    background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6)) !important;
    border-bottom-color: rgba(0, 255, 255, 0.5) !important;
}

/* --- Header para Fase de Fuerza --- */
.cyber-modal .modal-header.header-fase-fuerza {
    background: linear-gradient(45deg, rgba(255, 0, 100, 0.8), rgba(200, 0, 80, 0.6)) !important;
    border-bottom-color: rgba(255, 0, 100, 0.5) !important;
}

/* --- Header para Fase de Potencia --- */
.cyber-modal .modal-header.header-fase-potencia {
    background: linear-gradient(45deg, rgba(255, 165, 0, 0.8), rgba(255, 200, 0, 0.6)) !important;
    border-bottom-color: rgba(255, 165, 0, 0.5) !important;
}

/* --- Header para Fase de Descarga --- */
.cyber-modal .modal-header.header-fase-descarga {
    background: linear-gradient(45deg, rgba(0, 255, 100, 0.8), rgba(40, 167, 69, 0.6)) !important;
    border-bottom-color: rgba(0, 255, 100, 0.5) !important;
}

    /* === HEADERS DE DÍAS === */
    .cyber-calendar-day-header {
        text-align: center;
        font-weight: 700;
        color: #00ffff;
        padding: 1rem 0.5rem;
        background: rgba(0, 255, 255, 0.1);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 8px;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    /* === DÍAS DEL CALENDARIO === */
    .cyber-calendar-day {
        border: 1px solid rgba(77, 208, 225, 0.4);
        min-height: 120px;
        padding: 0.75rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px) saturate(150%);
        -webkit-backdrop-filter: blur(10px) saturate(150%);
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .cyber-calendar-day::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
        transition: left 0.6s ease;
    }

    .cyber-calendar-day:hover::before {
        left: 100%;
    }

    .cyber-calendar-day:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 20px rgba(77, 208, 225, 0.4), inset 0 0 10px rgba(77, 208, 225, 0.2);
        border-color: rgba(0, 255, 255, 0.6);
    }

    .cyber-calendar-day.empty {
        background: rgba(0, 0, 0, 0.2);
        border-color: rgba(77, 208, 225, 0.2);
        cursor: default;
    }

    .cyber-calendar-day.empty:hover {
        transform: none;
        box-shadow: none;
        border-color: rgba(77, 208, 225, 0.2);
    }

    .cyber-calendar-day.empty::before {
        display: none;
    }

    /* === DÍA ACTUAL === */
    .cyber-calendar-day.today {
        border-color: rgba(0, 255, 255, 0.8) !important;
        border-width: 2px;
        background: rgba(0, 255, 255, 0.1) !important;
        animation: pulse-neon 3s ease-in-out infinite;
        position: relative;
    }

    .cyber-calendar-day.today::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 6px;
        background: radial-gradient(circle at center, rgba(0, 255, 255, 0.2) 0%, transparent 70%);
        pointer-events: none;
    }

    /* === NÚMERO DEL DÍA === */
    .cyber-day-number {
        font-weight: 700;
        font-size: 1.1rem;
        color: #00ffff;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        margin-bottom: 0.5rem;
        display: block;
    }

    .cyber-calendar-day.today .cyber-day-number {
        color: #ffffff;
        text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        animation: dayPulse 2s ease-in-out infinite;
    }

    /* === ENTRADAS DE ENTRENAMIENTO === */
    .cyber-training-entry {
        background: linear-gradient(45deg, rgba(0, 255, 255, 0.8), rgba(0, 150, 255, 0.6));
        border: 1px solid rgba(0, 255, 255, 0.8);
        border-left: 3px solid #00ffff;
        padding: 0.5rem;
        margin-top: 0.5rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        color: #000000;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        position: relative;
        overflow: hidden;
    }
/* En el bloque <style> de tu plantilla */

/* ================================================== */
/* === ESTILOS PARA LA LEYENDA DE FASES === */
/* ================================================== */
.cyber-legend-container {
    margin-top: 2.5rem;
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(77, 208, 225, 0.4);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.cyber-legend-title {
    text-align: center;
    font-weight: 700;
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.cyber-legend-grid {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.cyber-legend-item {
    display: flex;
    align-items: center;
    gap: 12px;
    transition: transform 0.3s ease;
}

.cyber-legend-item:hover {
    transform: scale(1.05);
}

.legend-color-box {
    width: 25px;
    height: 25px;
    border-radius: 6px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    /* Los colores de fondo se heredarán de las clases de fase existentes */
}

.legend-text {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.legend-text strong {
    font-weight: 600;
    color: #ffffff;
    font-size: 0.95rem;
}

.legend-text span {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
}

/* --- Aplicando los colores de fase a la leyenda --- */
/* Usamos las mismas clases que en las entradas del calendario para mantener la consistencia */
.legend-color-box.fase-acumulacion {
    background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6));
    box-shadow: 0 0 10px rgba(0, 150, 255, 0.4);
}
.legend-color-box.fase-fuerza {
    background: linear-gradient(45deg, rgba(255, 0, 100, 0.8), rgba(200, 0, 80, 0.6));
    box-shadow: 0 0 10px rgba(255, 0, 100, 0.4);
}
.legend-color-box.fase-potencia {
    background: linear-gradient(45deg, rgba(255, 165, 0, 0.8), rgba(255, 200, 0, 0.6));
    box-shadow: 0 0 10px rgba(255, 165, 0, 0.4);
}
.legend-color-box.fase-descarga {
    background: linear-gradient(45deg, rgba(0, 255, 100, 0.8), rgba(40, 167, 69, 0.6));
    box-shadow: 0 0 10px rgba(0, 255, 100, 0.4);
}

    .cyber-training-entry::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.4s ease;
    }

    .cyber-training-entry:hover::before {
        left: 100%;
    }

    .cyber-training-entry:hover {
        background: linear-gradient(45deg, rgba(0, 255, 255, 1), rgba(0, 150, 255, 0.8));
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        transform: translateY(-1px) scale(1.02);
    }

    /* === ESTILOS DE FASE DE ENTRENAMIENTO === */
    .cyber-training-entry.fase-acumulacion {
        background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6));
        border-left-color: #00aeff;
        box-shadow: 0 0 10px rgba(0, 150, 255, 0.4);
    }
    .cyber-training-entry.fase-acumulacion:hover {
        background: linear-gradient(45deg, rgba(0, 123, 255, 1), rgba(0, 150, 255, 0.8));
        box-shadow: 0 0 15px rgba(0, 150, 255, 0.6);
    }

    .cyber-training-entry.fase-fuerza {
        background: linear-gradient(45deg, rgba(255, 0, 100, 0.8), rgba(200, 0, 80, 0.6));
        border-left-color: #ff0064;
        box-shadow: 0 0 10px rgba(255, 0, 100, 0.4);
    }
    .cyber-training-entry.fase-fuerza:hover {
        background: linear-gradient(45deg, rgba(255, 0, 100, 1), rgba(200, 0, 80, 0.8));
        box-shadow: 0 0 15px rgba(255, 0, 100, 0.6);
    }

    .cyber-training-entry.fase-potencia {
        background: linear-gradient(45deg, rgba(255, 165, 0, 0.8), rgba(255, 200, 0, 0.6));
        border-left-color: #ffa500;
        box-shadow: 0 0 10px rgba(255, 165, 0, 0.4);
    }
    .cyber-training-entry.fase-potencia:hover {
        background: linear-gradient(45deg, rgba(255, 165, 0, 1), rgba(255, 200, 0, 0.8));
        box-shadow: 0 0 15px rgba(255, 165, 0, 0.6);
    }

    .cyber-training-entry.fase-descarga {
        background: linear-gradient(45deg, rgba(0, 255, 100, 0.8), rgba(40, 167, 69, 0.6));
        border-left-color: #00ff64;
        box-shadow: 0 0 10px rgba(0, 255, 100, 0.4);
    }
    .cyber-training-entry.fase-descarga:hover {
        background: linear-gradient(45deg, rgba(0, 255, 100, 1), rgba(40, 167, 69, 0.8));
        box-shadow: 0 0 15px rgba(0, 255, 100, 0.6);
    }

    /* === MODAL CYBERPUNK === */
    .cyber-modal .modal-content {
        background: rgba(0, 0, 0, 0.9) !important;
        backdrop-filter: blur(20px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
        border: 1px solid rgba(0, 255, 255, 0.6) !important;
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.4), inset 0 0 15px rgba(0, 255, 255, 0.1) !important;
        border-radius: 15px;
        color: #ffffff;
    }

    .cyber-modal .modal-header {
        background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6)) !important;
        border-bottom: 1px solid rgba(0, 255, 255, 0.3) !important;
        border-radius: 15px 15px 0 0;
    }

    .cyber-modal .modal-title {
        color: #000000 !important;
        font-weight: 700;
        text-shadow: none;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .cyber-modal .btn-close {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        opacity: 1;
        transition: all 0.3s ease;
    }

    .cyber-modal .btn-close:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
    }

    .cyber-modal .modal-body {
        background: rgba(0, 0, 0, 0.7);
        color: #ffffff;
        padding: 2rem;
    }

    .cyber-modal .modal-footer {
        background: rgba(0, 0, 0, 0.8);
        border-top: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 0 0 15px 15px;
    }

    /* === LISTA DE EJERCICIOS EN MODAL === */
    .cyber-list-group {
        background: transparent;
    }

    .cyber-list-group-item {
        background: rgba(0, 0, 0, 0.6) !important;
        border: 1px solid rgba(0, 255, 255, 0.3) !important;
        color: #ffffff !important;
        margin-bottom: 0.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .cyber-list-group-item:hover {
        background: rgba(0, 255, 255, 0.1) !important;
        border-color: rgba(0, 255, 255, 0.6) !important;
        transform: translateX(5px);
    }

    .cyber-list-group-item strong {
        color: #00ffff;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
    }

    .cyber-list-group-item .text-muted {
        color: rgba(255, 255, 255, 0.7) !important;
    }

    .cyber-badge {
        background: linear-gradient(45deg, rgba(0, 123, 255, 0.8), rgba(0, 150, 255, 0.6)) !important;
        color: #ffffff !important;
        padding: 0.5em 0.8em;
        border-radius: 15px;
        font-weight: 600;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.4);
    }

    /* === BOTONES DEL MODAL === */
    .cyber-btn-secondary {
        background: rgba(0, 0, 0, 0.7) !important;
        border: 2px solid rgba(108, 117, 125, 0.6) !important;
        color: #ffffff !important;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .cyber-btn-secondary:hover {
        background: rgba(108, 117, 125, 0.2) !important;
        border-color: rgba(108, 117, 125, 0.8) !important;
        color: #ffffff !important;
        transform: translateY(-2px);
    }

    .cyber-btn-success {
        background: linear-gradient(45deg, rgba(40, 167, 69, 0.8), rgba(0, 255, 100, 0.6)) !important;
        border: 1px solid rgba(40, 167, 69, 0.8) !important;
        color: #000000 !important;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        box-shadow: 0 0 15px rgba(40, 167, 69, 0.4);
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .cyber-btn-success:hover {
        background: linear-gradient(45deg, rgba(40, 167, 69, 1), rgba(0, 255, 100, 0.8)) !important;
        box-shadow: 0 0 25px rgba(40, 167, 69, 0.6);
        transform: translateY(-2px);
        color: #000000 !important;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
        .cyber-calendar-container {
            padding: 1rem;
            margin: 1rem;
        }

        .cyber-calendar-header {
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
        }

        .cyber-calendar-header h3 {
            font-size: 1.5rem;
        }

        .cyber-calendar-day {
            min-height: 80px;
            padding: 0.5rem;
        }

        .cyber-calendar-day-header {
            padding: 0.5rem 0.25rem;
            font-size: 0.8rem;
        }

        .cyber-training-entry {
            font-size: 0.7rem;
            padding: 0.25rem;
        }

        .cyber-nav-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
    }

    /* === EFECTOS ADICIONALES === */
    .cyber-calendar-day:nth-child(7n+1) { animation-delay: 0.1s; }
    .cyber-calendar-day:nth-child(7n+2) { animation-delay: 0.2s; }
    .cyber-calendar-day:nth-child(7n+3) { animation-delay: 0.3s; }
    .cyber-calendar-day:nth-child(7n+4) { animation-delay: 0.4s; }
    .cyber-calendar-day:nth-child(7n+5) { animation-delay: 0.5s; }
    .cyber-calendar-day:nth-child(7n+6) { animation-delay: 0.6s; }
    .cyber-calendar-day:nth-child(7n+7) { animation-delay: 0.7s; }

    /* === LOADING EFFECTS === */
    .loading-calendar {
        position: relative;
        overflow: hidden;
    }

    .loading-calendar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
        animation: dataFlow 2s ease-in-out infinite;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-wrapper">
    {% if validacion_fallida %}
    <div class="container">
        <div class="cyber-calendar-container animate-fadeSlide" style="border-color: #ffc107;">
            <div class="cyber-entreno-header" style="border-color: #ffc107;">
                <h2 style="color: #ffc107; text-shadow: 0 0 15px #ffc107;"><i class="fas fa-shield-alt"></i> Fundamentos Primero</h2>
                <p class="lead">Para poder generar tu plan, primero necesitamos establecer una base sólida.</p>
            </div>
            <div class="p-4">
                <h4 class="text-white font-bold mb-3">Recomendaciones para empezar:</h4>
                <ul class="list-disc list-inside space-y-2 text-gray-300">
                    {% for rec in validacion.recomendaciones %}
                    <li><i class="fas fa-arrow-right text-cyan-400 mr-2"></i>{{ rec }}</li>
                    {% endfor %}
                </ul>
                <div class="text-center mt-6">
                    <a href="#" class="btn cyber-btn-finalizar" style="background: linear-gradient(45deg, #ffc107, #ff8c00);">
                        <i class="fas fa-user-edit"></i> Ir a mi Perfil para completar
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Efectos atmosféricos cyberpunk -->
    <div class="blade-runner-atmosphere">
        <div class="background-fog"></div>
    </div>

    <div class="container">
        <div class="cyber-calendar-container animate-fadeSlide">

            <!-- Header del calendario -->
            <div class="cyber-calendar-header animate-fadeSlide" style="animation-delay: 0.2s;">
                <a href="?año={{ nav.anterior.año }}&mes={{ nav.anterior.mes }}" class="cyber-nav-btn">
                    <i class="fas fa-chevron-left"></i> Anterior
                </a>
                <h3><i class="fas fa-calendar-alt"></i> {{ calendario.nombre_mes }} {{ calendario.año }}</h3>
                <a href="?año={{ nav.siguiente.año }}&mes={{ nav.siguiente.mes }}" class="cyber-nav-btn">
                    Siguiente <i class="fas fa-chevron-right"></i>
                </a>
            </div>

            <!-- Botón resumen anual -->
            <div class="text-center my-4 animate-fadeSlide" style="animation-delay: 0.3s;">
                <a href="{% url 'entrenos:vista_resumen_anual' cliente.id %}" class="cyber-nav-btn resumen-anual">
                    <i class="fas fa-stream"></i> Ver Resumen Anual
                </a>
            </div>

            <!-- Grid del calendario -->
            <div class="cyber-calendar-grid animate-fadeSlide" style="animation-delay: 0.4s;">

                <!-- Encabezados de los días -->
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 0.5s;">L</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 0.6s;">M</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 0.7s;">X</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 0.8s;">J</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 0.9s;">V</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 1.0s;">S</div>
                <div class="cyber-calendar-day-header animate-fadeSlide" style="animation-delay: 1.1s;">D</div>

                <!-- Días del mes -->
                {% for semana in calendario.semanas %}
                {% for dia in semana %}
                {% if dia %}
                <div class="cyber-calendar-day {% if dia.es_hoy %}today{% endif %} animate-fadeSlide"
                     style="animation-delay: {{ forloop.parentloop.counter|add:forloop.counter|floatformat:1 }}s;"
                     {% if dia.entrenamiento %}onclick="mostrarDetalles('{{ dia.numero }}')" {% endif %}>
                    <div class="cyber-day-number">{{ dia.numero }}</div>
                    {% if dia.entrenamiento %}
                    <div class="cyber-training-entry {{ dia.entrenamiento.fase_css }}">
                        <i class="fas fa-dumbbell"></i> {{ dia.entrenamiento.nombre_rutina }}
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="cyber-calendar-day empty animate-fadeSlide"
                     style="animation-delay: {{ forloop.parentloop.counter|add:forloop.counter|floatformat:1 }}s;"></div>
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Modal cyberpunk -->
    <div class="modal fade cyber-modal" id="detalleEntrenamientoModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">
                        <i class="fas fa-calendar-day"></i> Detalles del Entrenamiento
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- El contenido se inyectará aquí con JavaScript -->
                    <div id="modal-contenido-ejercicios">
                        <!-- Placeholder mientras carga -->
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin fa-2x" style="color: #00ffff;"></i>
                            <p class="mt-2">Cargando ejercicios...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn cyber-btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                    <!-- Este botón es la clave para la siguiente funcionalidad -->
                    <a href="#" id="btn-empezar-entreno" class="btn cyber-btn-success">
                        <i class="fas fa-play-circle"></i> Empezar Entrenamiento
                    </a>
                </div>
            </div>
            <div class="cyber-legend-container animate-fadeSlide" style="animation-delay: 1.2s;">
                <h5 class="cyber-legend-title"><i class="fas fa-map-signs"></i> Códice de Fases</h5>
                <div class="cyber-legend-grid">
                    <!-- Hipertrofia -->
                    <div class="cyber-legend-item">
                        <div class="legend-color-box fase-acumulacion"></div>
                        <div class="legend-text">
                            <strong>Acumulación</strong>
                            <span>(Hipertrofia)</span>
                        </div>
                    </div>
                    <!-- Fuerza -->
                    <div class="cyber-legend-item">
                        <div class="legend-color-box fase-fuerza"></div>
                        <div class="legend-text">
                            <strong>Fuerza</strong>
                            <span>(Intensidad)</span>
                        </div>
                    </div>
                    <!-- Potencia -->
                    <div class="cyber-legend-item">
                        <div class="legend-color-box fase-potencia"></div>
                        <div class="legend-text">
                            <strong>Potencia</strong>
                            <span>(Velocidad)</span>
                        </div>
                    </div>
                    <!-- Descarga -->
                    <div class="cyber-legend-item">
                        <div class="legend-color-box fase-descarga"></div>
                        <div class="legend-text">
                            <strong>Descarga</strong>
                            <span>(Recuperación)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Efectos adicionales de interactividad
    document.addEventListener('DOMContentLoaded', function() {
        // Efectos para días del calendario
        const calendarDays = document.querySelectorAll('.cyber-calendar-day:not(.empty)');
        calendarDays.forEach(day => {
            day.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-3px)';
            });

            day.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Efectos para entradas de entrenamiento
        const trainingEntries = document.querySelectorAll('.cyber-training-entry');
        trainingEntries.forEach(entry => {
            entry.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-1px) scale(1.02)';
            });

            entry.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Efectos para botones de navegación
        const navBtns = document.querySelectorAll('.cyber-nav-btn');
        navBtns.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });

            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    });

    // Datos de entrenamientos (se debe proporcionar desde Django)
    const diasDeEntreno = {{ entrenos_por_fecha_data|safe }};

    // Función mostrarDetalles con efectos cyberpunk
    function mostrarDetalles(dia) {
        // Obtener fecha seleccionada
        const añoActual = {{ calendario.año }};
        const mesActual = String({{ calendario.mes_num }}).padStart(2, '0');
        const diaActual = String(dia).padStart(2, '0');
        const fechaSeleccionada = `${añoActual}-${mesActual}-${diaActual}`;

        const entrenamiento = diasDeEntreno[fechaSeleccionada];
    const modalElement = document.getElementById('detalleEntrenamientoModal'); // Referencia al modal
    const modalHeader = modalElement.querySelector('.modal-header'); // Referencia a la cabecera
    const modalTitle = document.getElementById('modalLabel');
    const modalBody = document.getElementById('modal-contenido-ejercicios');
    const btnEmpezar = document.getElementById('btn-empezar-entreno');

            modalHeader.classList.remove('header-fase-acumulacion', 'header-fase-fuerza', 'header-fase-potencia', 'header-fase-descarga');

    if (entrenamiento) {
        // 2. Obtener la fase y añadir la nueva clase a la cabecera del modal
        const fase = entrenamiento.fase_css || 'fase-default'; // Usamos la misma variable que en el calendario
        // La clase en el calendario es 'fase-acumulacion', para el header usaremos 'header-fase-acumulacion'
        modalHeader.classList.add('header-' + fase);

        // (El resto de tu código para construir el HTML del modal permanece igual)
        let html = `<div class="space-y-4">`;
        entrenamiento.ejercicios.forEach((ej, index) => {
            html += `
            <div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700 animate-fadeSlide" style="animation-delay: ${index * 0.1}s;">
                <div class="flex justify-between items-center">
                    <strong class="text-cyan-400"><i class="fas fa-dumbbell"></i> ${ej.nombre.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong>
                    <span class="badge cyber-badge">${ej.series}x${ej.repeticiones} @ RPE ${ej.rpe_objetivo}</span>
                </div>
                <div class="mt-2 text-xs text-gray-400 border-t border-gray-700 pt-2">
                    <p><strong>Por qué este ejercicio:</strong> ${ej.explicacion_ejercicio}</p>
                    <p class="mt-1"><strong>Por qué estos parámetros:</strong> ${ej.explicacion_parametros.series}</p>
                </div>
            </div>
            `;
        });
        html += `</div>`;

        modalTitle.innerHTML = `<i class="fas fa-calendar-day"></i> ${entrenamiento.nombre_rutina}`;
        modalBody.innerHTML = html;

        let url = "{% url 'entrenos:entrenamiento_activo' cliente.id %}";
        const params = new URLSearchParams({
            fecha: fechaSeleccionada,
            rutina_nombre: entrenamiento.nombre_rutina,
            ejercicios: JSON.stringify(entrenamiento.ejercicios)
        });
        btnEmpezar.href = `${url}?${params.toString()}`;
        btnEmpezar.style.display = 'inline-flex';

        } else {
            modalBody.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-calendar-times fa-3x" style="color: rgba(255, 255, 255, 0.5); margin-bottom: 1rem;"></i>
                    <p class="text-muted">No hay entrenamiento programado para este día.</p>
                </div>
            `;
            btnEmpezar.style.display = 'none';
        }

        const modal = new bootstrap.Modal(document.getElementById('detalleEntrenamientoModal'));
        modal.show();

        // Efectos adicionales para el modal
        setTimeout(() => {
            const listItems = document.querySelectorAll('.cyber-list-group-item');
            listItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, index * 100);
            });
        }, 100);
    }

    // Efectos de carga inicial
    window.addEventListener('load', function() {
        const calendarContainer = document.querySelector('.cyber-calendar-container');
        calendarContainer.classList.add('loading-calendar');

        setTimeout(() => {
            calendarContainer.classList.remove('loading-calendar');
        }, 1000);
    });
</script>
{% endblock %}

