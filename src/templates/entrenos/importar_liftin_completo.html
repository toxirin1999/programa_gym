{% extends "base.html" %}
{% load static %}

{% block title %}Importar Entrenamiento - Nueva Gym{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    /* Estilos para el fondo y la atm√≥sfera */
    body {
      background: url("{% static 'images/fondo_cyberpunk.png' %}" ) no-repeat center center fixed !important;
      background-size: cover !important;
      background-color: #000000 !important;
    }

    /* Contenedor principal del formulario */
    .form-container-full-width {
        background: rgba(0, 0, 0, 0.6) !important;
        backdrop-filter: blur(20px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
        border: 1px solid rgba(77, 208, 225, 0.6) !important;
        box-shadow: 0 0 30px rgba(77, 208, 225, 0.5), inset 0 0 10px rgba(77, 208, 225, 0.2) !important;
        border-radius: 15px !important;
        padding: 2.5rem;
        width: 100%;
        max-width: 1200px; /* Ancho m√°ximo deseado */
        margin: 4rem auto; /* Margen para centrar y dar espacio arriba/abajo */
    }

    /* Estilos de los elementos del formulario (sin cambios) */
    .form-title {
        font-size: 2.5rem; font-weight: 800;
        background: linear-gradient(90deg, #00ffff, #00ff00, #ff00ff);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        margin-bottom: 0.5rem;
    }
    .form-subtitle { color: #a5f3fc; margin-bottom: 2.5rem; }
    .form-section {
        background: rgba(10, 10, 10, 0.6);
        border: 1px solid rgba(77, 208, 225, 0.4);
        border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;
        transition: all 0.3s ease;
    }
    .form-section:hover {
        border-color: rgba(77, 208, 225, 0.8);
        box-shadow: 0 0 10px rgba(77, 208, 225, 0.3);
    }
    .section-heading {
        font-size: 1.25rem; font-weight: 700; color: #67e8f9;
        margin-bottom: 1.5rem; border-bottom: 1px solid rgba(77, 208, 225, 0.2);
        padding-bottom: 0.75rem;
    }
    .form-input, .form-select, .form-textarea {
        width: 100%; background-color: rgba(0, 0, 0, 0.8);
        color: #e0e0e0; padding: 0.85rem 1rem; border-radius: 8px;
        border: 1px solid rgba(77, 208, 225, 0.5); transition: all 0.3s ease;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none; border-color: #00ffff;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .form-select option { background-color: #111827; }
    .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #bae6fd; }
    .form-checkbox {
        height: 1.25rem; width: 1.25rem;
        background-color: rgba(0, 0, 0, 0.7); border-color: rgba(77, 208, 225, 0.5);
        color: #00ff00; border-radius: 4px;
    }
    .form-checkbox:checked { background-color: #00ff00; }
    .submit-button {
        width: 100%; margin-top: 1.5rem; background: linear-gradient(45deg, #00ffff, #ff00ff);
        color: #000; font-weight: bold; border: none; padding: 1rem;
        border-radius: 8px; cursor: pointer; transition: all 0.3s ease;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
    }
    .submit-button:hover {
        box-shadow: 0 0 25px rgba(255, 0, 255, 0.7), 0 0 15px rgba(0, 255, 255, 0.7);
        transform: scale(1.02);
    }
</style>
{% endblock %}

{% block content %}
<!-- A√±adimos un ID √∫nico a nuestro contenedor principal -->
<div id="import-form-page">
    <div class="form-container-full-width">
        <div class="text-center mb-8">
            <h2 class="form-title">üì≤ Importar Entrenamiento</h2>
            <p class="form-subtitle">Carga tu entreno desde Liftin y personaliza cada detalle con precisi√≥n.</p>
        </div>

        <form method="post" class="space-y-6">
            {% csrf_token %}
            <!-- El resto del formulario va aqu√≠, sin cambios -->
            <div class="form-section">
                <h3 class="section-heading">üìã Detalles Generales</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label for="cliente" class="form-label">Cliente</label>
                        <select name="cliente" id="cliente" class="form-select">
                            {% for cliente in clientes %}
                            <option value="{{ cliente.id }}">{{ cliente.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="rutina" class="form-label">Rutina</label>
                        <select name="rutina" id="rutina" class="form-select">
                            {% for rutina in rutinas %}
                            <option value="{{ rutina.id }}">{{ rutina.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="fecha" class="form-label">Fecha</label>
                        <input type="date" name="fecha" class="form-input" value="{{ hoy|date:'Y-m-d' }}">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                    <input type="time" name="hora_inicio" placeholder="Hora inicio" class="form-input">
                    <input type="number" name="duracion_minutos" placeholder="Duraci√≥n (min)" class="form-input">
                    <input type="number" name="calorias_quemadas" placeholder="Calor√≠as" class="form-input">
                    <input type="number" step="0.1" name="volumen_total_kg" placeholder="Volumen (kg)" class="form-input">
                </div>
            </div>

            {% for i in "123456789" %}
            <div class="form-section">
                <h3 class="section-heading">üèãÔ∏è Ejercicio {{ i }}</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                    <select name="ejercicio_{{ i }}_nombre" class="form-select">
                        <option value="">Selecciona un ejercicio</option>
                    </select>
                    <input type="text" name="ejercicio_{{ i }}_grupo" readonly placeholder="Grupo muscular" class="form-input cursor-not-allowed">
                    <select name="ejercicio_{{ i }}_estado" class="form-select">
                        <option value="completado">‚úì Completado</option>
                        <option value="fallado">‚úó Fallado</option>
                        <option value="nuevo">Nuevo</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
                    <input type="number" step="0.1" name="ejercicio_{{ i }}_peso" placeholder="Peso (kg)" class="form-input">
                    <input type="number" name="ejercicio_{{ i }}_series" placeholder="Series" class="form-input">
                    <input type="number" name="ejercicio_{{ i }}_reps" placeholder="Reps" class="form-input">
                    <input type="text" name="ejercicio_{{ i }}_tempo" placeholder="Tempo" class="form-input">
                    <input type="number" name="ejercicio_{{ i }}_rpe" placeholder="RPE" class="form-input">
                    <input type="number" name="ejercicio_{{ i }}_rir" placeholder="RIR" class="form-input">
                </div>
                <div class="flex items-center space-x-6 justify-end mt-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="ejercicio_{{ i }}_fallo" class="form-checkbox">
                        <span class="ml-2">Fallo</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="ejercicio_{{ i }}_record" class="form-checkbox text-yellow-400">
                        <span class="ml-2">R√©cord</span>
                    </label>
                </div>
            </div>
            {% endfor %}

            <div class="form-section">
                <label for="notas" class="form-label">üìù Notas Generales</label>
                <textarea name="notas" rows="3" class="form-textarea" placeholder="Observaciones, sensaciones, etc."></textarea>
            </div>

            <button type="submit" class="submit-button">
                ‚úÖ Guardar Entrenamiento Completo
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // SCRIPT PARA ANULAR EL CONTENEDOR PADRE
    document.addEventListener('DOMContentLoaded', function() {
        const pageWrapper = document.getElementById('import-form-page');
        if (pageWrapper) {
            let parent = pageWrapper.parentElement;
            // Buscamos hacia arriba hasta encontrar el contenedor que limita el ancho
            while (parent && parent.tagName.toLowerCase() !== 'body') {
                // Eliminamos clases comunes de contenedores. A√±ade aqu√≠ otras si las conoces.
                parent.classList.remove('container', 'max-w-7xl', 'mx-auto');
                // Aplicamos estilos para forzar el ancho completo
                parent.style.maxWidth = 'none';
                parent.style.padding = '0';
                parent.style.margin = '0';
                parent = parent.parentElement;
            }
        }

        // El resto de tu script para los ejercicios
        const ejerciciosData = JSON.parse('{{ ejercicios|escapejs }}');
        for (let i = 1; i <= 9; i++) {
            const selectEjercicio = document.querySelector(`select[name="ejercicio_${i}_nombre"]`);
            const inputGrupo = document.querySelector(`input[name="ejercicio_${i}_grupo"]`);

            if (selectEjercicio && inputGrupo) {
                ejerciciosData.forEach(ejercicio => {
                    const option = document.createElement("option");
                    option.value = ejercicio.nombre;
                    option.textContent = ejercicio.nombre;
                    selectEjercicio.appendChild(option);
                });

                selectEjercicio.addEventListener("change", function () {
                    const seleccion = this.value;
                    const encontrado = ejerciciosData.find(e => e.nombre === seleccion);
                    inputGrupo.value = encontrado ? (encontrado.grupo_muscular || "") : "";
                });
            }
        }
    });
</script>
{% endblock %}
