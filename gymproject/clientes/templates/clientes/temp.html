{% extends "base.html" %}
{% load filtros %}


{% block title %}Detalle Cliente{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Detalle de Cliente: {{ cliente.nombre }}</h1>
    <div class="row">
        <div class="col-md-4">
            {% if cliente.foto %}
            <img src="{{ cliente.foto.url }}" class="img-fluid rounded shadow">
            {% else %}
            <div class="text-muted">Sin foto disponible</div>
            {% endif %}
        </div>
        <div class="col-12 col-md-8">
            <div class="row mt-4">

                <table class="table table-bordered">
                    <tr>
                        <th>ID</th>
                        <td>{{ cliente.id }}</td>
                    </tr>
                    <tr>
                        <th>Nombre</th>
                        <td>{{ cliente.nombre }}</td>
                    </tr>
                    <tr>
                        <th>Email</th>
                        <td>{{ cliente.email }}</td>
                    </tr>
                    <tr>
                        <th>Tel√©fono</th>
                        <td>{{ cliente.telefono }}</td>
                    </tr>
                    <tr>
                        <th>Fecha nacimiento</th>
                        <td>{{ cliente.fecha_nacimiento|date:"d/m/Y" }}</td>
                    </tr>
                    <tr>
                        <th>Direcci√≥n</th>
                        <td>{{ cliente.direccion }}</td>
                    </tr>
                    <tr>
                        <th>G√©nero</th>
                        <td>{{ cliente.get_genero_display }}</td>
                    </tr>
                    <tr>
                        <th>Membres√≠a activa</th>
                        <td>{% if cliente.membresia_activa %}S√≠{% else %}No{% endif %}</td>
                    </tr>
                    <tr>
                        <th>Vencimiento membres√≠a</th>
                        <td>{{ cliente.fecha_vencimiento_membresia|date:"d/m/Y" }}</td>
                    </tr>
                    <tr>
                        <th>Programa</th>
                        <td>
                            {{ cliente.programa.nombre }}
                            <a href="{% url 'editar_cliente' cliente.id %}" class="btn btn-sm btn-outline-warning">Cambiar
                                programa</a>
                        </td>
                    </tr>
                    {% with cliente.dietas_asignadas.last as ultima_dieta %}
                    {% if ultima_dieta %}
                    <tr>
                        <th>Dieta asignada</th>
                        <td>
                            {{ ultima_dieta.dieta.nombre }}
                            <small class="text-muted d-block">desde {{ ultima_dieta.fecha_inicio }}</small>
                            <div class="mt-2">
                                <a href="{% url 'ver_dieta' ultima_dieta.dieta.id %}"
                                   class="btn btn-sm btn-outline-primary">Ver dieta</a>
                                <a href="{% url 'asignar_dieta_directo' cliente.id %}"
                                   class="btn btn-sm btn-outline-success">Asignar nueva</a>
                            </div>
                        </td>
                    </tr>
                    {% endif %}
                    {% endwith %}
                </table>


            </div>

            <h4 class="mt-4">Comparativa de Medidas Corporales</h4>
            {% if ultima_revision %}
            <table class="table table-striped align-middle">
                <thead>
                <tr>
                    <th>Medida</th>
                    <th>Inicial</th>
                    <th>√öltima Revisi√≥n ({{ ultima_revision.fecha }})</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>Peso (kg)</th>
                    <td>{{ cliente.peso_corporal }}</td>
                    <td>
                        {% with inicial=cliente.peso_corporal revision=ultima_revision.peso_corporal %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <th>Grasa corporal (%)</th>
                    <td>{{ cliente.grasa_corporal }}</td>
                    <td>
                        {% with inicial=cliente.grasa_corporal revision=ultima_revision.grasa_corporal %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <th>Cintura (cm)</th>
                    <td>{{ cliente.cintura }}</td>
                    <td>
                        {% with inicial=cliente.cintura revision=ultima_revision.cintura %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <th>Pecho (cm)</th>
                    <td>{{ cliente.pecho }}</td>
                    <td>
                        {% with inicial=cliente.pecho revision=ultima_revision.pecho %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <th>B√≠ceps (cm)</th>
                    <td>{{ cliente.biceps }}</td>
                    <td>
                        {% with inicial=cliente.biceps revision=ultima_revision.biceps %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <th>Muslos (cm)</th>
                    <td>{{ cliente.muslos }}</td>
                    <td>
                        {% with inicial=cliente.muslos revision=ultima_revision.muslos %}
                        {% include "clientes/partials/comparador.html" %}
                        {% endwith %}
                    </td>
                </tr>
                <!-- Agrega m√°s medidas si usas hombro, cuello, etc. -->
                </tbody>
            </table>
            <div class="text-end mb-3">
                <a href="{% url 'agregar_revision' cliente.id %}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-plus-circle"></i> A√±adir revisi√≥n
                </a>
                <a href="{% url 'lista_revisiones' cliente.id %}" class="btn btn-outline-secondary btn-sm">
                    üìã Ver historial completo
                </a>
            </div>
            {% else %}
            <p class="text-muted">Sin revisiones registradas.</p>
            {% endif %}


            <hr>
            <h4>Historial de Dietas</h4>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Dieta</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Observaciones</th>
                </tr>
                </thead>
                <tbody>
                {% for cd in cliente.dietas_asignadas.all %}
                <tr>
                    <td>{{ cd.dieta.nombre }}</td>
                    <td>{{ cd.fecha_inicio }}</td>
                    <td>{% if cd.fecha_fin %}{{ cd.fecha_fin }}{% else %}<em>Actual</em>{% endif %}</td>
                    <td>{{ cd.observaciones|default:"‚Äî" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-muted">Sin historial de dietas.</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

            <div class="mt-4">

                <a href="{% url 'clientes_index' %}" class="btn btn-secondary mt-3">Volver a la lista</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
